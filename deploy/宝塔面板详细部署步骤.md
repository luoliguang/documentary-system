# ğŸš€ è·Ÿå•ç³»ç»Ÿ - å®å¡”é¢æ¿è¯¦ç»†éƒ¨ç½²æ­¥éª¤

> **ç›®æ ‡**: ä¸€æ­¥ä¸€æ­¥å®Œæˆéƒ¨ç½²ï¼Œæ¯ä¸ªæ­¥éª¤éƒ½æœ‰éªŒè¯æ–¹æ³•

---

## ğŸ“‹ å‰ç½®æ£€æŸ¥æ¸…å•

åœ¨å¼€å§‹ä¹‹å‰ï¼Œç¡®ä¿ï¼š
- [ ] å·²ç™»å½•å®å¡”é¢æ¿
- [ ] å·²ç™»å½•æœåŠ¡å™¨ SSH
- [ ] å·²å‡†å¤‡å¥½åŸŸåï¼ˆå¯é€‰ï¼Œå¯ä»¥å…ˆæµ‹è¯• IP è®¿é—®ï¼‰
- [ ] å·²å‡†å¤‡å¥½æ•°æ®åº“å¯†ç ï¼ˆå»ºè®®ä½¿ç”¨å¼ºå¯†ç ï¼‰

---

## ç¬¬ä¸€æ­¥ï¼šä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨ï¼ˆ5åˆ†é’Ÿï¼‰

### 1.1 é€‰æ‹©ä¸Šä¼ æ–¹å¼

**æ–¹å¼Aï¼šä½¿ç”¨ Gitï¼ˆæ¨èï¼‰**

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
cd /www/wwwroot
git clone https://github.com/your-username/fangdu-website-follow.git fangdu-system
cd fangdu-system
```

**æ–¹å¼Bï¼šä½¿ç”¨å®å¡”é¢æ¿æ–‡ä»¶ç®¡ç†å™¨**

1. ç™»å½•å®å¡”é¢æ¿
2. è¿›å…¥ã€Œæ–‡ä»¶ã€â†’ `/www/wwwroot/`
3. ä¸Šä¼ é¡¹ç›®å‹ç¼©åŒ…
4. è§£å‹å¹¶é‡å‘½åä¸º `fangdu-system`

### 1.2 éªŒè¯ä»£ç å·²ä¸Šä¼ 

```bash
# æ£€æŸ¥é¡¹ç›®ç›®å½•
ls -la /www/wwwroot/fangdu-system

# åº”è¯¥çœ‹åˆ°ä»¥ä¸‹ç›®å½•ï¼š
# backend/  frontend/  database/  deploy/  package.json
```

âœ… **éªŒè¯æˆåŠŸæ ‡å¿—**: èƒ½çœ‹åˆ° `package.json` å’Œ `backend`ã€`frontend` ç›®å½•

---

## ç¬¬äºŒæ­¥ï¼šä¿®å¤æ–‡ä»¶æ¢è¡Œç¬¦ï¼ˆ2åˆ†é’Ÿï¼‰

### 2.1 è½¬æ¢è„šæœ¬æ–‡ä»¶æ¢è¡Œç¬¦

```bash
cd /www/wwwroot/fangdu-system/deploy/database

# è½¬æ¢æ¢è¡Œç¬¦ï¼ˆé‡è¦ï¼ï¼‰
sed -i 's/\r$//' setup-db.sh
sed -i 's/\r$//' init-database.sh

# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x setup-db.sh
chmod +x init-database.sh

# éªŒè¯æ–‡ä»¶æ ¼å¼
file setup-db.sh
# åº”è¯¥æ˜¾ç¤º: setup-db.sh: Bourne-Again shell script, ASCII text executable
```

âœ… **éªŒè¯æˆåŠŸæ ‡å¿—**: `file` å‘½ä»¤æ˜¾ç¤ºä¸º `ASCII text executable`ï¼ˆä¸æ˜¯ `CRLF` æˆ– `with CR line terminators`ï¼‰

---

## ç¬¬ä¸‰æ­¥ï¼šç¯å¢ƒå‡†å¤‡ï¼ˆ5åˆ†é’Ÿï¼‰

### 3.1 æ£€æŸ¥ Node.js

```bash
# æ£€æŸ¥ Node.js æ˜¯å¦å®‰è£…
node -v
npm -v

# å¦‚æœæ²¡æœ‰å®‰è£…ï¼Œæ‰§è¡Œï¼š
curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
sudo yum install -y nodejs
```

âœ… **éªŒè¯æˆåŠŸæ ‡å¿—**: `node -v` æ˜¾ç¤º `v18.x.x` æˆ–æ›´é«˜ç‰ˆæœ¬

### 3.2 æ£€æŸ¥ PM2

```bash
# æ£€æŸ¥ PM2 æ˜¯å¦å®‰è£…
pm2 -v

# å¦‚æœæ²¡æœ‰å®‰è£…ï¼Œæ‰§è¡Œï¼š
sudo npm install -g pm2
```

âœ… **éªŒè¯æˆåŠŸæ ‡å¿—**: `pm2 -v` æ˜¾ç¤ºç‰ˆæœ¬å·

### 3.3 æ£€æŸ¥ PostgreSQL

```bash
# æ£€æŸ¥ PostgreSQL è·¯å¾„
ls -la /www/server/pgsql/bin/psql

# å¦‚æœä¸å­˜åœ¨ï¼Œåœ¨å®å¡”é¢æ¿ä¸­å®‰è£… PostgreSQL
# å®å¡”é¢æ¿ â†’ è½¯ä»¶å•†åº— â†’ æœç´¢ PostgreSQL â†’ å®‰è£…
```

âœ… **éªŒè¯æˆåŠŸæ ‡å¿—**: èƒ½çœ‹åˆ° `/www/server/pgsql/bin/psql` æ–‡ä»¶

---

## ç¬¬å››æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡ï¼ˆ5åˆ†é’Ÿï¼‰

### 4.1 åˆ›å»º .env æ–‡ä»¶

```bash
cd /www/wwwroot/fangdu-system

# å¤åˆ¶ç¤ºä¾‹æ–‡ä»¶
cp deploy/env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
nano .env
# æˆ–ä½¿ç”¨ vi
vi .env
```

### 4.2 å¡«å†™ç¯å¢ƒå˜é‡

**æœ€å°å¿…é¡»é…ç½®ï¼š**

```env
NODE_ENV=production
PORT=3006

# JWT å¯†é’¥ï¼ˆå¿…é¡»ä¿®æ”¹ï¼ç”Ÿæˆéšæœºå­—ç¬¦ä¸²ï¼‰
JWT_SECRET=ä½ çš„éšæœºå­—ç¬¦ä¸²ï¼ˆè‡³å°‘32ä½ï¼‰

# CORS é…ç½®ï¼ˆä½ çš„åŸŸåï¼Œå¦‚æœæ²¡æœ‰åŸŸåå…ˆç”¨ IPï¼‰
CORS_ORIGIN=http://your-server-ip:5176
# æˆ–
CORS_ORIGIN=https://your-domain.com

# æ•°æ®åº“é…ç½®ï¼ˆç¨ååˆ›å»ºæ•°æ®åº“æ—¶ä½¿ç”¨ï¼‰
DB_HOST=localhost
DB_PORT=5432
DB_NAME=fangdu_db
DB_USER=fangdu_user
DB_PASSWORD=ä½ çš„å¼ºå¯†ç ï¼ˆè‡³å°‘16ä½ï¼‰
```

### 4.3 ç”Ÿæˆ JWT_SECRET

```bash
# ç”Ÿæˆéšæœºå­—ç¬¦ä¸²
openssl rand -base64 32

# å¤åˆ¶ç”Ÿæˆçš„å­—ç¬¦ä¸²ï¼Œå¡«å…¥ .env çš„ JWT_SECRET
```

### 4.4 éªŒè¯ .env æ–‡ä»¶

```bash
# æ£€æŸ¥æ–‡ä»¶æ ¼å¼ï¼ˆç¡®ä¿æ˜¯ Unix æ ¼å¼ï¼‰
file .env

# æŸ¥çœ‹é…ç½®ï¼ˆä¸æ˜¾ç¤ºå¯†ç ï¼‰
cat .env | grep -v PASSWORD

# æ£€æŸ¥æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯
cat .env | grep -E '^[A-Z_]+='
```

âœ… **éªŒè¯æˆåŠŸæ ‡å¿—**: 
- `file .env` æ˜¾ç¤º `ASCII text`
- èƒ½çœ‹åˆ°æ‰€æœ‰é…ç½®é¡¹éƒ½æœ‰å€¼

---

## ç¬¬äº”æ­¥ï¼šåˆ›å»ºæ•°æ®åº“ï¼ˆ10åˆ†é’Ÿï¼‰

### 5.1 åœ¨å®å¡”é¢æ¿åˆ›å»ºæ•°æ®åº“

1. ç™»å½•å®å¡”é¢æ¿
2. è¿›å…¥ã€Œæ•°æ®åº“ã€â†’ã€ŒPostgreSQL ç®¡ç†ã€
3. ç‚¹å‡»ã€Œæ·»åŠ æ•°æ®åº“ã€
4. å¡«å†™ä¿¡æ¯ï¼š
   - **æ•°æ®åº“å**: `fangdu_db`
   - **ç”¨æˆ·å**: `fangdu_user`
   - **å¯†ç **: ç”Ÿæˆå¼ºå¯†ç ï¼ˆä¸ .env ä¸­çš„ `DB_PASSWORD` ä¿æŒä¸€è‡´ï¼‰
   - **è®¿é—®æƒé™**: æœ¬åœ°æœåŠ¡å™¨
5. ç‚¹å‡»ã€Œæäº¤ã€
6. **è®°å½•æ•°æ®åº“ä¿¡æ¯**ï¼ˆç”¨æˆ·åã€å¯†ç ï¼‰

### 5.2 æ›´æ–° .env æ–‡ä»¶

```bash
# ç¼–è¾‘ .envï¼Œç¡®ä¿æ•°æ®åº“ä¿¡æ¯æ­£ç¡®
nano /www/wwwroot/fangdu-system/.env

# æ£€æŸ¥æ•°æ®åº“é…ç½®
cat .env | grep DB_
```

âœ… **éªŒè¯æˆåŠŸæ ‡å¿—**: `.env` ä¸­çš„æ•°æ®åº“ä¿¡æ¯ä¸å®å¡”é¢æ¿åˆ›å»ºçš„ä¸€è‡´

### 5.3 æ‰§è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬

```bash
cd /www/wwwroot/fangdu-system/deploy/database

# ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™
chmod +x setup-db.sh init-database.sh

# è½¬æ¢æ¢è¡Œç¬¦ï¼ˆå¦‚æœè¿˜æ²¡è½¬æ¢ï¼‰
sed -i 's/\r$//' setup-db.sh
sed -i 's/\r$//' init-database.sh

# æ‰§è¡Œæ•°æ®åº“åˆ›å»ºè„šæœ¬ï¼ˆå¦‚æœå®å¡”é¢æ¿å·²åˆ›å»ºï¼Œè¿™ä¸€æ­¥å¯èƒ½æŠ¥é”™è¯´å·²å­˜åœ¨ï¼Œå¯ä»¥å¿½ç•¥ï¼‰
./setup-db.sh
```

**å¦‚æœæŠ¥é”™è¯´æ•°æ®åº“å·²å­˜åœ¨ï¼Œå¯ä»¥å¿½ç•¥**ï¼ˆå› ä¸ºå®å¡”é¢æ¿å·²åˆ›å»ºï¼‰

### 5.4 åˆå§‹åŒ–æ•°æ®åº“è¡¨ç»“æ„

```bash
# è®¾ç½® PostgreSQL è·¯å¾„åˆ° PATH
export PATH="/www/server/pgsql/bin:$PATH"

# è®¾ç½®æ•°æ®åº“å¯†ç ç¯å¢ƒå˜é‡ï¼ˆé¿å…äº¤äº’å¼è¾“å…¥ï¼‰
export PGPASSWORD=ä½ çš„æ•°æ®åº“å¯†ç 

# æ‰§è¡Œè¡¨ç»“æ„åˆå§‹åŒ–
./init-database.sh
```

âœ… **éªŒè¯æˆåŠŸæ ‡å¿—**: 
- è„šæœ¬æ‰§è¡Œå®Œæˆï¼Œæ²¡æœ‰é”™è¯¯
- çœ‹åˆ° "âœ… æ•°æ®åº“åˆå§‹åŒ–å®Œæˆï¼"

### 5.5 éªŒè¯æ•°æ®åº“è¡¨å·²åˆ›å»º

```bash
# è¿æ¥æ•°æ®åº“æŸ¥çœ‹è¡¨
export PATH="/www/server/pgsql/bin:$PATH"
export PGPASSWORD=ä½ çš„æ•°æ®åº“å¯†ç 

/www/server/pgsql/bin/psql -h localhost -U fangdu_user -d fangdu_db -c "\dt"

# åº”è¯¥çœ‹åˆ°è¡¨åˆ—è¡¨ï¼š
# users, orders, delivery_reminders, order_status_history ç­‰
```

âœ… **éªŒè¯æˆåŠŸæ ‡å¿—**: èƒ½çœ‹åˆ°å¤šä¸ªè¡¨ï¼ˆusers, orders ç­‰ï¼‰

---

## ç¬¬å…­æ­¥ï¼šå®‰è£…é¡¹ç›®ä¾èµ–ï¼ˆ10åˆ†é’Ÿï¼‰

### 6.1 å®‰è£…æ ¹ç›®å½•ä¾èµ–

```bash
cd /www/wwwroot/fangdu-system

# å®‰è£…ä¾èµ–
npm install

# å¦‚æœç½‘ç»œæ…¢ï¼Œå¯ä»¥ä½¿ç”¨å›½å†…é•œåƒ
npm install --registry=https://registry.npmmirror.com
```

âœ… **éªŒè¯æˆåŠŸæ ‡å¿—**: çœ‹åˆ° `added XXX packages`ï¼Œæ²¡æœ‰é”™è¯¯

### 6.2 å®‰è£…å‰ç«¯ä¾èµ–

```bash
cd frontend

# å®‰è£…ä¾èµ–
npm install
# æˆ–ä½¿ç”¨é•œåƒ
npm install --registry=https://registry.npmmirror.com

# æ„å»ºå‰ç«¯
npm run build

# éªŒè¯æ„å»ºæˆåŠŸ
ls -la dist/
# åº”è¯¥çœ‹åˆ° index.html å’Œ assets/ ç›®å½•
```

âœ… **éªŒè¯æˆåŠŸæ ‡å¿—**: 
- `dist/` ç›®å½•å­˜åœ¨
- `dist/index.html` å­˜åœ¨
- `dist/assets/` ç›®å½•å­˜åœ¨

### 6.3 å®‰è£…åç«¯ä¾èµ–

```bash
cd ../backend

# å®‰è£…ä¾èµ–
npm install
# æˆ–ä½¿ç”¨é•œåƒ
npm install --registry=https://registry.npmmirror.com

# æ„å»ºåç«¯
npm run build

# éªŒè¯æ„å»ºæˆåŠŸ
ls -la dist/
# åº”è¯¥çœ‹åˆ° index.js æ–‡ä»¶
```

âœ… **éªŒè¯æˆåŠŸæ ‡å¿—**: 
- `dist/` ç›®å½•å­˜åœ¨
- `dist/index.js` å­˜åœ¨

---

## ç¬¬ä¸ƒæ­¥ï¼šå¯åŠ¨åç«¯æœåŠ¡ï¼ˆ5åˆ†é’Ÿï¼‰

### 7.1 åˆ›å»ºå¿…è¦ç›®å½•

```bash
cd /www/wwwroot/fangdu-system

# åˆ›å»ºä¸Šä¼ ç›®å½•
mkdir -p backend/uploads
chmod 755 backend/uploads

# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p /www/wwwlogs/fangdu
chmod 755 /www/wwwlogs/fangdu
```

### 7.2 å¯åŠ¨ PM2 æœåŠ¡

```bash
cd /www/wwwroot/fangdu-system/backend

# è®¾ç½® PostgreSQL è·¯å¾„ï¼ˆå¦‚æœéœ€è¦ï¼‰
export PATH="/www/server/pgsql/bin:$PATH"

# å¯åŠ¨æœåŠ¡
pm2 start dist/index.js \
    --name "fangdu-backend" \
    --log "/www/wwwlogs/fangdu/backend.log" \
    --error "/www/wwwlogs/fangdu/backend-error.log" \
    --time \
    --restart-delay=3000 \
    --max-restarts=10

# ä¿å­˜ PM2 é…ç½®
pm2 save
```

### 7.3 éªŒè¯æœåŠ¡è¿è¡Œ

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 list

# åº”è¯¥çœ‹åˆ°ï¼š
# â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ id  â”‚ name         â”‚ status  â”‚ restart â”‚ uptime   â”‚
# â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚ 0   â”‚ fangdu-backend â”‚ online  â”‚ 0       â”‚ 10s      â”‚
# â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

# æŸ¥çœ‹æ—¥å¿—
pm2 logs fangdu-backend --lines 20

# æµ‹è¯• API
curl http://localhost:3006/health

# åº”è¯¥è¿”å›ï¼š
# {"status":"ok","message":"è·Ÿå•ç³»ç»ŸAPIè¿è¡Œæ­£å¸¸"}
```

âœ… **éªŒè¯æˆåŠŸæ ‡å¿—**: 
- `pm2 list` æ˜¾ç¤º `fangdu-backend` çŠ¶æ€ä¸º `online`
- `curl http://localhost:3006/health` è¿”å› JSON å“åº”
- æ—¥å¿—ä¸­æ²¡æœ‰é”™è¯¯ä¿¡æ¯

### 7.4 å¦‚æœæœåŠ¡å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
pm2 logs fangdu-backend --err --lines 50

# å¸¸è§é—®é¢˜ï¼š
# 1. æ•°æ®åº“è¿æ¥å¤±è´¥ â†’ æ£€æŸ¥ .env ä¸­çš„æ•°æ®åº“é…ç½®
# 2. ç«¯å£è¢«å ç”¨ â†’ æ£€æŸ¥ç«¯å£ 3006 æ˜¯å¦è¢«å ç”¨
# 3. æ‰¾ä¸åˆ°æ¨¡å— â†’ æ£€æŸ¥æ˜¯å¦æ‰§è¡Œäº† npm install å’Œ npm run build
```

---

## ç¬¬å…«æ­¥ï¼šé…ç½®å®å¡”é¢æ¿ç«™ç‚¹ï¼ˆ10åˆ†é’Ÿï¼‰

### 8.1 æ·»åŠ ç«™ç‚¹

1. ç™»å½•å®å¡”é¢æ¿
2. è¿›å…¥ã€Œç½‘ç«™ã€â†’ã€Œæ·»åŠ ç«™ç‚¹ã€
3. å¡«å†™ä¿¡æ¯ï¼š
   - **åŸŸå**: `your-domain.com`ï¼ˆæˆ–ä½¿ç”¨ IPï¼‰
   - **å¤‡æ³¨**: è·Ÿå•ç³»ç»Ÿ
   - **æ ¹ç›®å½•**: `/www/wwwroot/fangdu-system/frontend/dist`
   - **PHP ç‰ˆæœ¬**: çº¯é™æ€ï¼ˆä¸éœ€è¦ PHPï¼‰
4. ç‚¹å‡»ã€Œæäº¤ã€

### 8.2 é…ç½®åå‘ä»£ç†

1. è¿›å…¥ã€Œç½‘ç«™ã€â†’ ç‚¹å‡»ä½ çš„åŸŸå â†’ã€Œè®¾ç½®ã€
2. è¿›å…¥ã€Œåå‘ä»£ç†ã€æ ‡ç­¾
3. ç‚¹å‡»ã€Œæ·»åŠ åå‘ä»£ç†ã€
4. å¡«å†™é…ç½®ï¼š
   - **ä»£ç†åç§°**: `fangdu-api`
   - **ç›®æ ‡URL**: `http://127.0.0.1:3006`
   - **å‘é€åŸŸå**: `$host`
   - **å†…å®¹æ›¿æ¢**: ç•™ç©º
5. ç‚¹å‡»ã€Œæäº¤ã€

### 8.3 é…ç½® SSL è¯ä¹¦ï¼ˆå¦‚æœæœ‰åŸŸåï¼‰

1. è¿›å…¥ã€Œç½‘ç«™ã€â†’ ç‚¹å‡»ä½ çš„åŸŸå â†’ã€Œè®¾ç½®ã€
2. è¿›å…¥ã€ŒSSLã€æ ‡ç­¾
3. é€‰æ‹©ã€ŒLet's Encryptã€
4. å¡«å†™é‚®ç®±
5. å‹¾é€‰åŸŸåï¼ˆyour-domain.com å’Œ www.your-domain.comï¼‰
6. ç‚¹å‡»ã€Œç”³è¯·ã€
7. ç”³è¯·æˆåŠŸåï¼Œå¼€å¯ã€Œå¼ºåˆ¶ HTTPSã€

### 8.4 é…ç½®é˜²ç«å¢™

1. è¿›å…¥ã€Œå®‰å…¨ã€â†’ã€Œé˜²ç«å¢™ã€
2. æ·»åŠ è§„åˆ™ï¼š
   - **ç«¯å£**: `3006`
   - **åè®®**: `TCP`
   - **å¤‡æ³¨**: è·Ÿå•ç³»ç»Ÿåç«¯API
3. ç‚¹å‡»ã€Œæ”¾è¡Œã€

### 8.5 éªŒè¯é…ç½®

```bash
# æµ‹è¯•å‰ç«¯è®¿é—®
curl http://your-domain.com
# æˆ–
curl http://your-server-ip

# åº”è¯¥è¿”å› HTML å†…å®¹ï¼ˆå‰ç«¯é¡µé¢ï¼‰

# æµ‹è¯• API è®¿é—®
curl http://your-domain.com/api/health
# æˆ–
curl http://your-server-ip/api/health

# åº”è¯¥è¿”å›ï¼š
# {"status":"ok","message":"è·Ÿå•ç³»ç»ŸAPIè¿è¡Œæ­£å¸¸"}
```

âœ… **éªŒè¯æˆåŠŸæ ‡å¿—**: 
- å‰ç«¯é¡µé¢å¯ä»¥è®¿é—®ï¼ˆè¿”å› HTMLï¼‰
- API æ¥å£å¯ä»¥è®¿é—®ï¼ˆè¿”å› JSONï¼‰

---

## ç¬¬ä¹æ­¥ï¼šæœ€ç»ˆéªŒè¯ï¼ˆ5åˆ†é’Ÿï¼‰

### 9.1 æœåŠ¡çŠ¶æ€æ£€æŸ¥

```bash
# PM2 æœåŠ¡
pm2 list

# åç«¯æ—¥å¿—
pm2 logs fangdu-backend --lines 10

# æµ‹è¯•æœ¬åœ° API
curl http://localhost:3006/health
```

### 9.2 æµè§ˆå™¨è®¿é—®æµ‹è¯•

1. æ‰“å¼€æµè§ˆå™¨
2. è®¿é—®: `http://your-domain.com` æˆ– `http://your-server-ip`
3. åº”è¯¥èƒ½çœ‹åˆ°ç™»å½•é¡µé¢
4. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
5. æ£€æŸ¥ Network æ ‡ç­¾ï¼ŒAPI è¯·æ±‚åº”è¯¥è¿”å› 200 çŠ¶æ€ç 

### 9.3 æ•°æ®åº“è¿æ¥æµ‹è¯•

```bash
export PATH="/www/server/pgsql/bin:$PATH"
export PGPASSWORD=ä½ çš„æ•°æ®åº“å¯†ç 

/www/server/pgsql/bin/psql -h localhost -U fangdu_user -d fangdu_db -c "SELECT COUNT(*) FROM users;"
```

âœ… **éªŒè¯æˆåŠŸæ ‡å¿—**: æ‰€æœ‰æ£€æŸ¥éƒ½é€šè¿‡

---

## ğŸ†˜ å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: PM2 æœåŠ¡å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
pm2 logs fangdu-backend --err --lines 50

# æ£€æŸ¥å¸¸è§åŸå› ï¼š
# 1. æ•°æ®åº“è¿æ¥å¤±è´¥
cat .env | grep DB_
# 2. ç«¯å£è¢«å ç”¨
netstat -tlnp | grep 3006
# 3. ç¯å¢ƒå˜é‡æœªåŠ è½½
pm2 env fangdu-backend
```

### é—®é¢˜2: 502 Bad Gateway

```bash
# æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ
pm2 list

# æ£€æŸ¥åç«¯æ—¥å¿—
pm2 logs fangdu-backend

# æ£€æŸ¥ Nginx é”™è¯¯æ—¥å¿—
tail -f /www/wwwlogs/your-domain.com.error.log

# æµ‹è¯•åç«¯ API
curl http://127.0.0.1:3006/health
```

### é—®é¢˜3: æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥æ•°æ®åº“æœåŠ¡
# å®å¡”é¢æ¿ â†’ æ•°æ®åº“ â†’ PostgreSQL ç®¡ç† â†’ æŸ¥çœ‹çŠ¶æ€

# æµ‹è¯•æ•°æ®åº“è¿æ¥
export PATH="/www/server/pgsql/bin:$PATH"
export PGPASSWORD=ä½ çš„æ•°æ®åº“å¯†ç 
/www/server/pgsql/bin/psql -h localhost -U fangdu_user -d fangdu_db -c "SELECT 1;"
```

### é—®é¢˜4: å‰ç«¯é¡µé¢ç©ºç™½

```bash
# æ£€æŸ¥å‰ç«¯æ„å»ºæ–‡ä»¶
ls -la /www/wwwroot/fangdu-system/frontend/dist/

# æ£€æŸ¥ Nginx é…ç½®
# å®å¡”é¢æ¿ â†’ ç½‘ç«™ â†’ è®¾ç½® â†’ ç½‘ç«™ç›®å½• åº”è¯¥æ˜¯ /www/wwwroot/fangdu-system/frontend/dist

# æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ï¼ˆF12ï¼‰
```

### é—®é¢˜5: API è¯·æ±‚ 404

```bash
# æ£€æŸ¥åå‘ä»£ç†é…ç½®
# å®å¡”é¢æ¿ â†’ ç½‘ç«™ â†’ è®¾ç½® â†’ åå‘ä»£ç†
# ç›®æ ‡URL åº”è¯¥æ˜¯: http://127.0.0.1:3006

# æµ‹è¯•åç«¯ç›´æ¥è®¿é—®
curl http://127.0.0.1:3006/health

# æ£€æŸ¥ Nginx é…ç½®
cat /www/server/panel/vhost/nginx/your-domain.com.conf | grep -A 10 "location /api"
```

---

## ğŸ“ éƒ¨ç½²åç»´æŠ¤

### æ›´æ–°ä»£ç 

```bash
cd /www/wwwroot/fangdu-system

# æ‹‰å–æœ€æ–°ä»£ç 
git pull

# æ›´æ–°ä¾èµ–
npm install
cd frontend && npm install && npm run build && cd ..
cd backend && npm install && npm run build && cd ..

# é‡å¯æœåŠ¡
pm2 restart fangdu-backend
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# PM2 æ—¥å¿—
pm2 logs fangdu-backend

# Nginx æ—¥å¿—
tail -f /www/wwwlogs/your-domain.com.log
tail -f /www/wwwlogs/your-domain.com.error.log
```

### é‡å¯æœåŠ¡

```bash
pm2 restart fangdu-backend
pm2 stop fangdu-backend
pm2 start fangdu-backend
```

---

## âœ… éƒ¨ç½²å®Œæˆæ£€æŸ¥æ¸…å•

- [ ] ä»£ç å·²ä¸Šä¼ åˆ°æœåŠ¡å™¨
- [ ] æ–‡ä»¶æ¢è¡Œç¬¦å·²è½¬æ¢
- [ ] Node.js å’Œ PM2 å·²å®‰è£…
- [ ] PostgreSQL å·²å®‰è£…å¹¶å¯è®¿é—®
- [ ] .env æ–‡ä»¶å·²é…ç½®
- [ ] æ•°æ®åº“å·²åˆ›å»ºå¹¶åˆå§‹åŒ–
- [ ] é¡¹ç›®ä¾èµ–å·²å®‰è£…
- [ ] å‰åç«¯å·²æ„å»º
- [ ] PM2 æœåŠ¡å·²å¯åŠ¨
- [ ] å®å¡”é¢æ¿ç«™ç‚¹å·²æ·»åŠ 
- [ ] åå‘ä»£ç†å·²é…ç½®
- [ ] SSL è¯ä¹¦å·²å®‰è£…ï¼ˆå¦‚æœæœ‰åŸŸåï¼‰
- [ ] é˜²ç«å¢™ç«¯å£å·²å¼€æ”¾
- [ ] å‰ç«¯é¡µé¢å¯ä»¥è®¿é—®
- [ ] API æ¥å£å¯ä»¥è®¿é—®
- [ ] æµè§ˆå™¨è®¿é—®æ­£å¸¸

---

**å®Œæˆï¼ç°åœ¨å¯ä»¥é€šè¿‡åŸŸåæˆ– IP è®¿é—®ç³»ç»Ÿäº†ï¼ğŸ‰**

