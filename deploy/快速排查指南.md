# ğŸ” å¿«é€Ÿæ’æŸ¥æŒ‡å—

> é‡åˆ°é—®é¢˜æ—¶ï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤å¿«é€Ÿå®šä½é—®é¢˜

---

## 1ï¸âƒ£ æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ

```bash
# æŸ¥çœ‹ PM2 æœåŠ¡çŠ¶æ€
pm2 list

# åº”è¯¥çœ‹åˆ° fangdu-backend çŠ¶æ€ä¸º online
# å¦‚æœæ˜¾ç¤º errored æˆ– stoppedï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼š
pm2 logs fangdu-backend --err --lines 50
```

**é—®é¢˜**: æœåŠ¡æœªè¿è¡Œ
- **è§£å†³**: `pm2 restart fangdu-backend`

---

## 2ï¸âƒ£ æ£€æŸ¥åç«¯ API æ˜¯å¦å¯è®¿é—®

```bash
# æµ‹è¯•æœ¬åœ° API
curl http://localhost:3006/health

# åº”è¯¥è¿”å›: {"status":"ok","message":"è·Ÿå•ç³»ç»ŸAPIè¿è¡Œæ­£å¸¸"}
```

**é—®é¢˜**: è¿æ¥æ‹’ç»æˆ–è¶…æ—¶
- **æ£€æŸ¥**: `pm2 list` æŸ¥çœ‹æœåŠ¡çŠ¶æ€
- **æ£€æŸ¥**: `pm2 logs fangdu-backend` æŸ¥çœ‹é”™è¯¯æ—¥å¿—
- **æ£€æŸ¥**: ç«¯å£æ˜¯å¦è¢«å ç”¨ `netstat -tlnp | grep 3006`

---

## 3ï¸âƒ£ æ£€æŸ¥æ•°æ®åº“è¿æ¥

```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
export PATH="/www/server/pgsql/bin:$PATH"
export PGPASSWORD=ä½ çš„æ•°æ®åº“å¯†ç 
/www/server/pgsql/bin/psql -h localhost -U fangdu_user -d fangdu_db -c "SELECT 1;"
```

**é—®é¢˜**: è¿æ¥å¤±è´¥
- **æ£€æŸ¥**: å®å¡”é¢æ¿ â†’ æ•°æ®åº“ â†’ PostgreSQL ç®¡ç† â†’ æŸ¥çœ‹æœåŠ¡çŠ¶æ€
- **æ£€æŸ¥**: `.env` æ–‡ä»¶ä¸­çš„æ•°æ®åº“é…ç½®æ˜¯å¦æ­£ç¡®
- **æ£€æŸ¥**: æ•°æ®åº“ç”¨æˆ·å’Œå¯†ç æ˜¯å¦æ­£ç¡®

---

## 4ï¸âƒ£ æ£€æŸ¥ç¯å¢ƒå˜é‡

```bash
# æŸ¥çœ‹ .env æ–‡ä»¶
cat /www/wwwroot/fangdu-system/.env

# æ£€æŸ¥å…³é”®é…ç½®
cat .env | grep -E "(DB_|JWT_SECRET|PORT|CORS_ORIGIN)"
```

**é—®é¢˜**: é…ç½®é”™è¯¯
- **æ£€æŸ¥**: æ‰€æœ‰å¿…éœ€çš„ç¯å¢ƒå˜é‡æ˜¯å¦éƒ½å·²è®¾ç½®
- **æ£€æŸ¥**: å€¼æ˜¯å¦æ­£ç¡®ï¼ˆæ²¡æœ‰å¤šä½™ç©ºæ ¼ã€å¼•å·ç­‰ï¼‰

---

## 5ï¸âƒ£ æ£€æŸ¥æ–‡ä»¶è·¯å¾„

```bash
# æ£€æŸ¥é¡¹ç›®ç›®å½•
ls -la /www/wwwroot/fangdu-system/

# æ£€æŸ¥å‰ç«¯æ„å»ºæ–‡ä»¶
ls -la /www/wwwroot/fangdu-system/frontend/dist/

# æ£€æŸ¥åç«¯æ„å»ºæ–‡ä»¶
ls -la /www/wwwroot/fangdu-system/backend/dist/
```

**é—®é¢˜**: æ–‡ä»¶ä¸å­˜åœ¨
- **è§£å†³**: é‡æ–°æ„å»º `npm run build`

---

## 6ï¸âƒ£ æ£€æŸ¥ Nginx é…ç½®

```bash
# æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
tail -f /www/wwwlogs/your-domain.com.error.log

# æ£€æŸ¥åå‘ä»£ç†é…ç½®
cat /www/server/panel/vhost/nginx/your-domain.com.conf | grep -A 10 "location /api"
```

**é—®é¢˜**: 502 Bad Gateway
- **æ£€æŸ¥**: åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ
- **æ£€æŸ¥**: åå‘ä»£ç†ç›®æ ‡URLæ˜¯å¦æ­£ç¡® `http://127.0.0.1:3006`
- **æ£€æŸ¥**: é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ 3006 ç«¯å£

---

## 7ï¸âƒ£ æ£€æŸ¥æ–‡ä»¶æƒé™

```bash
# æ£€æŸ¥é¡¹ç›®ç›®å½•æƒé™
ls -la /www/wwwroot/fangdu-system/

# æ£€æŸ¥ä¸Šä¼ ç›®å½•æƒé™
ls -la /www/wwwroot/fangdu-system/backend/uploads/
```

**é—®é¢˜**: æƒé™ä¸è¶³
- **è§£å†³**: `chmod -R 755 /www/wwwroot/fangdu-system`
- **è§£å†³**: `chown -R www:www /www/wwwroot/fangdu-system`ï¼ˆå¦‚æœéœ€è¦ï¼‰

---

## 8ï¸âƒ£ æ£€æŸ¥æ—¥å¿—æ–‡ä»¶

```bash
# PM2 æ—¥å¿—
pm2 logs fangdu-backend --lines 50

# Nginx è®¿é—®æ—¥å¿—
tail -f /www/wwwlogs/your-domain.com.log

# Nginx é”™è¯¯æ—¥å¿—
tail -f /www/wwwlogs/your-domain.com.error.log

# åç«¯é”™è¯¯æ—¥å¿—
tail -f /www/wwwlogs/fangdu/backend-error.log
```

**é—®é¢˜**: æŸ¥çœ‹å…·ä½“é”™è¯¯ä¿¡æ¯
- **æ ¹æ®é”™è¯¯ä¿¡æ¯**: æŸ¥æ‰¾å¯¹åº”çš„è§£å†³æ–¹æ¡ˆ

---

## ğŸ¯ å¸¸è§é”™è¯¯å¿«é€Ÿä¿®å¤

### é”™è¯¯: `psql: command not found`
```bash
export PATH="/www/server/pgsql/bin:$PATH"
```

### é”™è¯¯: `$'\r': command not found`
```bash
sed -i 's/\r$//' è„šæœ¬æ–‡ä»¶å.sh
```

### é”™è¯¯: `Cannot find module`
```bash
cd /www/wwwroot/fangdu-system
npm install
cd backend && npm install && npm run build
```

### é”™è¯¯: `EADDRINUSE: address already in use`
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
netstat -tlnp | grep 3006
# æ€æ­»è¿›ç¨‹æˆ–ä¿®æ”¹ .env ä¸­çš„ PORT
```

### é”™è¯¯: `password authentication failed`
```bash
# æ£€æŸ¥ .env ä¸­çš„æ•°æ®åº“å¯†ç 
# ç¡®ä¿ä¸å®å¡”é¢æ¿ä¸­åˆ›å»ºçš„æ•°æ®åº“å¯†ç ä¸€è‡´
```

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœä»¥ä¸Šæ­¥éª¤éƒ½æ— æ³•è§£å†³é—®é¢˜ï¼š

1. **æ”¶é›†é”™è¯¯ä¿¡æ¯**:
   ```bash
   pm2 logs fangdu-backend --err --lines 100 > error.log
   ```

2. **æ£€æŸ¥ç³»ç»Ÿä¿¡æ¯**:
   ```bash
   node -v
   npm -v
   pm2 -v
   ls -la /www/server/pgsql/bin/psql
   ```

3. **æ£€æŸ¥é…ç½®æ–‡ä»¶**:
   ```bash
   cat .env | grep -v PASSWORD
   ```

4. **æä¾›ä»¥ä¸Šä¿¡æ¯å¯»æ±‚å¸®åŠ©**

