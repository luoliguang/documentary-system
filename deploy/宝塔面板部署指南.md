# ğŸš€ è·Ÿå•ç³»ç»Ÿ - å®å¡”é¢æ¿éƒ¨ç½²å®Œæ•´æŒ‡å—

> **é€‚ç”¨**: é˜¿é‡Œäº‘ ECS + å®å¡”é¢æ¿  
> **ç‰¹ç‚¹**: ä¸å½±å“ç°æœ‰é¡¹ç›®ï¼Œç‹¬ç«‹éƒ¨ç½²

---

## ğŸ“‹ ç›®å½•

1. [ç¯å¢ƒå‡†å¤‡](#1-ç¯å¢ƒå‡†å¤‡)
2. [é¡¹ç›®éƒ¨ç½²](#2-é¡¹ç›®éƒ¨ç½²)
3. [å®å¡”é¢æ¿é…ç½®](#3-å®å¡”é¢æ¿é…ç½®)
4. [æ•°æ®åº“é…ç½®](#4-æ•°æ®åº“é…ç½®)
5. [å¸¸è§é—®é¢˜](#5-å¸¸è§é—®é¢˜)

---

## 1. ç¯å¢ƒå‡†å¤‡

### 1.1 æ£€æŸ¥å®å¡”é¢æ¿ç¯å¢ƒ

ç¡®ä¿å®å¡”é¢æ¿å·²å®‰è£…å¹¶æ­£å¸¸è¿è¡Œï¼š

```bash
# æ£€æŸ¥å®å¡”é¢æ¿
ls /www/server/panel
```

### 1.2 æ‰§è¡Œç¯å¢ƒå‡†å¤‡è„šæœ¬

```bash
# ä¸Šä¼ é¡¹ç›®ä»£ç åï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
chmod +x deploy/server-setup-baota.sh
./deploy/server-setup-baota.sh
```

**è„šæœ¬ä¼šè‡ªåŠ¨ï¼š**
- âœ… æ£€æµ‹å®å¡”é¢æ¿
- âœ… å®‰è£… Node.js 18+ï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
- âœ… å®‰è£… PM2ï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
- âœ… æ£€æŸ¥æ•°æ®åº“ï¼ˆä¸å®‰è£…ï¼Œä½¿ç”¨å®å¡”é¢æ¿çš„ï¼‰
- âœ… ä¸å®‰è£… Nginxï¼ˆä½¿ç”¨å®å¡”é¢æ¿çš„ï¼‰
- âœ… åˆ›å»ºé¡¹ç›®ç›®å½•

---

## 2. é¡¹ç›®éƒ¨ç½²

### 2.1 ä¸Šä¼ ä»£ç 

**æ–¹æ³•1: ä½¿ç”¨ Git**

```bash
# åœ¨æœåŠ¡å™¨ä¸Šï¼ˆå»ºè®®ä½¿ç”¨ /www/wwwroot/ï¼‰
cd /www/wwwroot
git clone https://github.com/your-username/fangdu-website-follow.git fangdu-system
cd fangdu-system
```

**æ–¹æ³•2: ä½¿ç”¨å®å¡”é¢æ¿æ–‡ä»¶ç®¡ç†å™¨**

1. ç™»å½•å®å¡”é¢æ¿
2. è¿›å…¥ã€Œæ–‡ä»¶ã€â†’ `/www/wwwroot/`
3. ä¸Šä¼ é¡¹ç›®å‹ç¼©åŒ…å¹¶è§£å‹
4. é‡å‘½åä¸º `fangdu-system`

### 2.2 é…ç½®ç¯å¢ƒå˜é‡

```bash
cd /www/wwwroot/fangdu-system

# å¤åˆ¶ç¤ºä¾‹æ–‡ä»¶
cp deploy/env.example .env

# ç¼–è¾‘é…ç½®
nano .env
```

**æœ€å°é…ç½®ï¼ˆ.envï¼‰ï¼š**

```env
NODE_ENV=production
PORT=3006
JWT_SECRET=ç”Ÿæˆéšæœºå­—ç¬¦ä¸²ï¼ˆopenssl rand -base64 32ï¼‰
CORS_ORIGIN=https://your-domain.com

# æ•°æ®åº“é…ç½®ï¼ˆä½¿ç”¨å®å¡”é¢æ¿åˆ›å»ºçš„æ•°æ®åº“ï¼‰
DB_HOST=localhost
DB_PORT=5432  # PostgreSQL ç«¯å£ï¼ŒMySQL ä½¿ç”¨ 3306
DB_NAME=fangdu_db
DB_USER=fangdu_user
DB_PASSWORD=ä½ çš„æ•°æ®åº“å¯†ç 
```

### 2.3 åˆå§‹åŒ–æ•°æ®åº“

**åœ¨å®å¡”é¢æ¿ä¸­åˆ›å»ºæ•°æ®åº“ï¼š**

1. ç™»å½•å®å¡”é¢æ¿
2. è¿›å…¥ã€Œæ•°æ®åº“ã€
3. ç‚¹å‡»ã€Œæ·»åŠ æ•°æ®åº“ã€
4. å¡«å†™ä¿¡æ¯ï¼š
   - æ•°æ®åº“å: `fangdu_db`
   - ç”¨æˆ·å: `fangdu_user`
   - å¯†ç : ç”Ÿæˆå¼ºå¯†ç 
   - ç±»å‹: PostgreSQLï¼ˆæ¨èï¼‰æˆ– MySQL
5. ç‚¹å‡»ã€Œæäº¤ã€

**æ‰§è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ï¼š**

```bash
cd /www/wwwroot/fangdu-system/deploy/database

# å¦‚æœæ˜¯ PostgreSQL
chmod +x setup-db.sh init-database.sh
./setup-db.sh
./init-database.sh

# å¦‚æœæ˜¯ MySQLï¼Œéœ€è¦ä¿®æ”¹è„šæœ¬æˆ–æ‰‹åŠ¨æ‰§è¡Œ SQL
# åœ¨å®å¡”é¢æ¿ã€Œæ•°æ®åº“ã€â†’ã€ŒphpMyAdminã€ä¸­æ‰§è¡Œ database/schema.sql
```

### 2.4 ä¸€é”®éƒ¨ç½²

```bash
cd /www/wwwroot/fangdu-system
chmod +x deploy/deploy-baota.sh
./deploy/deploy-baota.sh
```

---

## 3. å®å¡”é¢æ¿é…ç½®

### 3.1 æ·»åŠ ç«™ç‚¹

1. ç™»å½•å®å¡”é¢æ¿
2. è¿›å…¥ã€Œç½‘ç«™ã€â†’ã€Œæ·»åŠ ç«™ç‚¹ã€
3. å¡«å†™ä¿¡æ¯ï¼š
   - åŸŸå: `your-domain.com`ï¼ˆä½ çš„åŸŸåï¼‰
   - å¤‡æ³¨: è·Ÿå•ç³»ç»Ÿ
   - æ ¹ç›®å½•: `/www/wwwroot/fangdu-system/frontend/dist`
   - PHP ç‰ˆæœ¬: çº¯é™æ€ï¼ˆä¸éœ€è¦ PHPï¼‰
4. ç‚¹å‡»ã€Œæäº¤ã€

### 3.2 é…ç½®åå‘ä»£ç†

1. è¿›å…¥ã€Œç½‘ç«™ã€â†’ ç‚¹å‡»ä½ çš„åŸŸå â†’ã€Œè®¾ç½®ã€
2. è¿›å…¥ã€Œåå‘ä»£ç†ã€æ ‡ç­¾
3. ç‚¹å‡»ã€Œæ·»åŠ åå‘ä»£ç†ã€
4. å¡«å†™é…ç½®ï¼š
   - ä»£ç†åç§°: `fangdu-api`
   - ç›®æ ‡URL: `http://127.0.0.1:3006`
   - å‘é€åŸŸå: `$host`
   - å†…å®¹æ›¿æ¢: ä¸å¡«
5. ç‚¹å‡»ã€Œæäº¤ã€

**é«˜çº§é…ç½®ï¼ˆå¯é€‰ï¼‰ï¼š**

ç‚¹å‡»ã€Œé…ç½®æ–‡ä»¶ã€ï¼Œåœ¨ `location /api` å—ä¸­æ·»åŠ ï¼š

```nginx
location /api {
    proxy_pass http://127.0.0.1:3006;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection 'upgrade';
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_cache_bypass $http_upgrade;
    
    # è¶…æ—¶è®¾ç½®
    proxy_connect_timeout 60s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;
    
    # æ–‡ä»¶ä¸Šä¼ å¤§å°
    client_max_body_size 50M;
}
```

### 3.3 é…ç½® SSL è¯ä¹¦

1. è¿›å…¥ã€Œç½‘ç«™ã€â†’ ç‚¹å‡»ä½ çš„åŸŸå â†’ã€Œè®¾ç½®ã€
2. è¿›å…¥ã€ŒSSLã€æ ‡ç­¾
3. é€‰æ‹©ã€ŒLet's Encryptã€
4. å¡«å†™é‚®ç®±
5. å‹¾é€‰åŸŸåï¼ˆyour-domain.com å’Œ www.your-domain.comï¼‰
6. ç‚¹å‡»ã€Œç”³è¯·ã€
7. ç”³è¯·æˆåŠŸåï¼Œå¼€å¯ã€Œå¼ºåˆ¶ HTTPSã€

### 3.4 é…ç½®é˜²ç«å¢™

1. è¿›å…¥ã€Œå®‰å…¨ã€â†’ã€Œé˜²ç«å¢™ã€
2. æ·»åŠ è§„åˆ™ï¼š
   - ç«¯å£: `3006`
   - åè®®: `TCP`
   - å¤‡æ³¨: è·Ÿå•ç³»ç»Ÿåç«¯API
3. ç‚¹å‡»ã€Œæ”¾è¡Œã€

**æ³¨æ„**: 80 å’Œ 443 ç«¯å£å®å¡”é¢æ¿é»˜è®¤å·²å¼€æ”¾ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚

---

## 4. æ•°æ®åº“é…ç½®

### 4.1 PostgreSQL é…ç½®ï¼ˆæ¨èï¼‰

**åœ¨å®å¡”é¢æ¿ä¸­ï¼š**

1. è¿›å…¥ã€Œæ•°æ®åº“ã€â†’ã€ŒPostgreSQL ç®¡ç†ã€
2. åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·ï¼ˆå¦‚å·²åˆ›å»ºï¼Œè·³è¿‡ï¼‰
3. è®°å½•è¿æ¥ä¿¡æ¯

**æ‰§è¡Œåˆå§‹åŒ–ï¼š**

```bash
cd /www/wwwroot/fangdu-system/deploy/database

# ä¿®æ”¹ setup-db.sh ä¸­çš„æ•°æ®åº“ä¿¡æ¯ï¼ˆå¦‚æœéœ€è¦ï¼‰
nano setup-db.sh

# æ‰§è¡Œåˆå§‹åŒ–
chmod +x setup-db.sh init-database.sh
./setup-db.sh
./init-database.sh
```

### 4.2 MySQL é…ç½®ï¼ˆå¤‡é€‰ï¼‰

å¦‚æœä½¿ç”¨ MySQLï¼š

1. åœ¨å®å¡”é¢æ¿åˆ›å»º MySQL æ•°æ®åº“
2. è¿›å…¥ã€Œæ•°æ®åº“ã€â†’ã€ŒphpMyAdminã€
3. é€‰æ‹©ä½ çš„æ•°æ®åº“
4. å¯¼å…¥ `database/schema.sql`ï¼ˆéœ€è¦è½¬æ¢ä¸º MySQL è¯­æ³•ï¼‰

**æ³¨æ„**: é¡¹ç›®é»˜è®¤ä½¿ç”¨ PostgreSQLï¼Œå¦‚æœä½¿ç”¨ MySQL éœ€è¦ï¼š
- ä¿®æ”¹ `.env` ä¸­çš„ `DB_PORT=3306`
- å¯èƒ½éœ€è¦è°ƒæ•´ SQL è¯­æ³•ï¼ˆPostgreSQL å’Œ MySQL æœ‰å·®å¼‚ï¼‰

---

## 5. å¸¸è§é—®é¢˜

### 5.1 502 Bad Gateway

**åŸå› **: åç«¯æœåŠ¡æœªå¯åŠ¨æˆ–ç«¯å£ä¸å¯¹

**è§£å†³ï¼š**

```bash
# æ£€æŸ¥ PM2 æœåŠ¡
pm2 list

# æŸ¥çœ‹æ—¥å¿—
pm2 logs fangdu-backend

# é‡å¯æœåŠ¡
pm2 restart fangdu-backend

# æ£€æŸ¥ç«¯å£
netstat -tlnp | grep 3006
```

### 5.2 æ•°æ®åº“è¿æ¥å¤±è´¥

**æ£€æŸ¥ï¼š**

1. å®å¡”é¢æ¿ã€Œæ•°æ®åº“ã€ä¸­ç¡®è®¤æ•°æ®åº“å·²åˆ›å»º
2. æ£€æŸ¥ `.env` ä¸­çš„æ•°æ®åº“é…ç½®
3. æµ‹è¯•è¿æ¥ï¼š

```bash
# PostgreSQL
psql -h localhost -U fangdu_user -d fangdu_db

# MySQL
mysql -h localhost -u fangdu_user -p fangdu_db
```

### 5.3 å‰ç«¯é¡µé¢ç©ºç™½

**æ£€æŸ¥ï¼š**

1. å®å¡”é¢æ¿ã€Œç½‘ç«™ã€è®¾ç½®ä¸­ï¼Œæ ¹ç›®å½•æ˜¯å¦æ­£ç¡®ï¼š`/www/wwwroot/fangdu-system/frontend/dist`
2. æ£€æŸ¥å‰ç«¯æ„å»ºæ–‡ä»¶ï¼š

```bash
ls -la /www/wwwroot/fangdu-system/frontend/dist/
```

3. é‡æ–°æ„å»ºå‰ç«¯ï¼š

```bash
cd /www/wwwroot/fangdu-system/frontend
npm run build
```

### 5.4 API è¯·æ±‚ 404

**æ£€æŸ¥åå‘ä»£ç†é…ç½®ï¼š**

1. å®å¡”é¢æ¿ã€Œç½‘ç«™ã€â†’ åŸŸåè®¾ç½® â†’ã€Œåå‘ä»£ç†ã€
2. ç¡®è®¤ç›®æ ‡ URL: `http://127.0.0.1:3006`
3. ç¡®è®¤ä»£ç†è·¯å¾„: `/api`
4. æµ‹è¯•åç«¯ APIï¼š

```bash
curl http://127.0.0.1:3006/health
```

### 5.5 æ–‡ä»¶ä¸Šä¼ å¤±è´¥

**æ£€æŸ¥ï¼š**

1. ä¸Šä¼ ç›®å½•æƒé™ï¼š

```bash
chmod -R 755 /www/wwwroot/fangdu-system/backend/uploads
chown -R www:www /www/wwwroot/fangdu-system/backend/uploads
```

2. å®å¡”é¢æ¿ Nginx é…ç½®ä¸­è®¾ç½®ä¸Šä¼ å¤§å°é™åˆ¶ï¼ˆå·²åœ¨åå‘ä»£ç†é…ç½®ä¸­è®¾ç½®ï¼‰

### 5.6 PM2 æœåŠ¡é‡å¯åæ¶ˆå¤±

**è®¾ç½®å¼€æœºè‡ªå¯ï¼š**

```bash
# ä¿å­˜å½“å‰ PM2 é…ç½®
pm2 save

# è®¾ç½®å¼€æœºè‡ªå¯ï¼ˆéœ€è¦ root æƒé™ï¼‰
sudo pm2 startup systemd -u $USER --hp $HOME
# æ‰§è¡Œè¾“å‡ºçš„å‘½ä»¤
```

---

## ğŸ“ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 list

# æŸ¥çœ‹æ—¥å¿—
pm2 logs fangdu-backend

# é‡å¯æœåŠ¡
pm2 restart fangdu-backend

# æ›´æ–°ä»£ç 
cd /www/wwwroot/fangdu-system
git pull
npm install
cd frontend && npm run build && cd ..
cd backend && npm run build && cd ..
pm2 restart fangdu-backend

# æµ‹è¯• API
curl http://127.0.0.1:3006/health
```

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] ç¯å¢ƒå‡†å¤‡è„šæœ¬å·²æ‰§è¡Œ
- [ ] ä»£ç å·²ä¸Šä¼ åˆ° `/www/wwwroot/fangdu-system`
- [ ] `.env` æ–‡ä»¶å·²é…ç½®
- [ ] æ•°æ®åº“å·²åœ¨å®å¡”é¢æ¿ä¸­åˆ›å»º
- [ ] æ•°æ®åº“è¡¨ç»“æ„å·²åˆå§‹åŒ–
- [ ] PM2 æœåŠ¡å·²å¯åŠ¨
- [ ] å®å¡”é¢æ¿å·²æ·»åŠ ç«™ç‚¹
- [ ] åå‘ä»£ç†å·²é…ç½®ï¼ˆ`/api` â†’ `http://127.0.0.1:3006`ï¼‰
- [ ] SSL è¯ä¹¦å·²å®‰è£…
- [ ] é˜²ç«å¢™ç«¯å£ 3006 å·²å¼€æ”¾
- [ ] å‰ç«¯é¡µé¢å¯ä»¥è®¿é—®
- [ ] API æ¥å£å¯ä»¥è®¿é—®
- [ ] ç™»å½•åŠŸèƒ½æ­£å¸¸

---

## ğŸ¯ ä¸ç°æœ‰é¡¹ç›®éš”ç¦»è¯´æ˜

âœ… **å®Œå…¨éš”ç¦»ï¼Œä¸å½±å“å…¶ä»–é¡¹ç›®ï¼š**

1. **ç‹¬ç«‹ç«¯å£**: åç«¯ä½¿ç”¨ 3006 ç«¯å£ï¼Œä¸å ç”¨ 80/443
2. **ç‹¬ç«‹ç›®å½•**: é¡¹ç›®åœ¨ `/www/wwwroot/fangdu-system`ï¼Œä¸å…¶ä»–é¡¹ç›®åˆ†ç¦»
3. **ç‹¬ç«‹æ•°æ®åº“**: ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®åº“å’Œç”¨æˆ·
4. **ç‹¬ç«‹ PM2 è¿›ç¨‹**: ä½¿ç”¨ç‹¬ç«‹çš„è¿›ç¨‹åç§° `fangdu-backend`
5. **å®å¡”é¢æ¿ç®¡ç†**: é€šè¿‡å®å¡”é¢æ¿æ·»åŠ ç«™ç‚¹ï¼Œä¸å½±å“ç°æœ‰ç«™ç‚¹é…ç½®

---

**ç¥éƒ¨ç½²é¡ºåˆ©ï¼ğŸ‰**

